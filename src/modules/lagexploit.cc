#include <precompiled.hh>

#include "lagexploit.hh"

#include <sdk/convar.hh>
#include <sdk/player.hh>
#include <utils/profiler.hh>

using namespace sdk;

static Convar<bool> doghook_lagexploit_active = Convar<bool>{"doghook_lagexploit_active", false, nullptr};
static Convar<int>  doghook_lagexploit_ticks  = Convar<int>{"doghook_lagexploit_ticks", 3, 0, INT_MAX, nullptr};
static Convar<bool> doghook_lagexploit_backup = Convar<bool>{"doghook_lagexploit_backup", false, nullptr};

namespace lagexploit {
void create_move(UserCmd *cmd) {   // TODO: add more usefull shit
	profiler_profile_function(); // WHY??

	auto local = IFace<EntList>()->entity(IFace<Engine>()->local_player_index())->to_player();

	if (!local) // should never happen but never say never
		return;

	if (!local->alive())
		return;

	if (!doghook_lagexploit_active)
		return; 
	
	// TODO: add actual button
	IFace<Engine>()->net_channel_info()->m_nOutSequenceNr() += doghook_lagexploit_ticks * (doghook_lagexploit_backup ? 90 : 66);
};
}; // namespace lagexploit
